# Keyjawn worker — operational reference

Autonomous social media agent for keyjawn. Monitors Twitter, Bluesky, and Product Hunt, curates dev tool content, and posts/engages with Telegram approval.

---

## CRITICAL: deployment requirements

**The worker MUST run on officejawn.** It cannot run on houseofjawn.

Two reasons:

1. **Virtual desktop (DISPLAY=:99)** — The social-scroller uses Playwright to drive a real Chrome browser. That browser runs on officejawn's `virtual-desktop.service` (Xvfb + LXDE + x11vnc). Houseofjawn has no virtual display.

2. **CDP endpoint** — The Chrome browser exposes `http://127.0.0.1:9222` (Chrome DevTools Protocol). This is localhost-relative. Running the script on any other machine means it can't reach the browser.

**`SocialScrollerConfig.ssh_host` must be `""` (empty).** An empty `ssh_host` tells `SocialScrollerClient._run_cmd()` to execute the script locally, not via SSH. If someone sets this to `"houseofjawn"`, the social-scroller will fail silently with exit code 1 — the CDP connection times out and no posts are extracted.

This was a production bug from 2026-02-18. The logs showed `social-scroller exited 1` every scan cycle until caught. The config default is now fixed but is worth knowing about.

**Service status:** `sudo systemctl status keyjawn-worker` (on officejawn)
**Service logs:** `sudo journalctl -u keyjawn-worker -f`

---

## Architecture

```
social-scroller.py (DISPLAY=:99, CDP:9222)
  └── reads Twitter, Bluesky, Reddit, YouTube feeds via real browser
  └── returns JSON → SocialScrollerClient → monitor.queue_new_findings()

Twitter API (twikit, cookie-based)
Bluesky API (atproto)
Product Hunt API (developer token)
  └── each returns posts → monitor.queue_new_findings()

Curation pipeline (RSS, YouTube API, Twitch API, Google Alerts)
  └── CurationMonitor → AI scoring → approved candidates

           ↓ all findings land in keyjawn-worker.db

ActionPicker (daily budget, EscalationTier)
  ├── AUTO tier: like/repost/follow (no approval needed)
  └── BUTTONS tier: replies, shares → Telegram inline buttons → human approves

           ↓ approved actions

Runner → Twitter/Bluesky platform clients → post
```

---

## Platform clients

| Client | File | Capabilities |
|--------|------|-------------|
| Twitter | `platforms/twitter.py` | search, post, reply, like, retweet |
| Bluesky | `platforms/bluesky.py` | search, post, reply |
| Product Hunt | `platforms/producthunt.py` | monitor new launches |
| Social scroller | `platforms/social_scroller.py` | browser-based feed scan, keyword search |

The social scroller supplements the API clients — it can reach platforms (Reddit, YouTube, Instagram) that don't have usable APIs, and it sees content as a logged-in user would.

---

## Social-scroller setup

**Script location:** `~/social-scroller.py` (on officejawn)
**Virtual desktop:** `sudo systemctl status virtual-desktop` — must be running
**Chrome:** must be launched with remote debugging enabled:
```bash
DISPLAY=:99 chromium-browser --remote-debugging-port=9222 --no-first-run &
```

**Verify CDP is up:**
```bash
python3 ~/social-scroller.py status
```

**Manual test runs:**
```bash
# Scan open feed tabs
python3 ~/social-scroller.py --json --no-screenshots -d 15 scroll --feeds twitter,bluesky

# Search Reddit
python3 ~/social-scroller.py --json --no-screenshots -d 15 search -p reddit -q "SSH from phone" -s commandline

# Check CDP + list open tabs
python3 ~/social-scroller.py status
```

---

## Content generation

Posts are generated by Gemini CLI (`gemini -p <prompt>`). The product description in `worker/content.py:build_generation_prompt()` is what Gemini knows about keyjawn. **When new features ship or the product changes, update that string.** It's the single source of truth for post content.

Current product knowledge includes:
- Android: Esc/Tab/Ctrl/arrow row, voice input, SCP upload, slash commands, $4 purchase
- Android UX (v1.2+): backspace acceleration, spacebar cursor drag, adaptive Enter key, double-tap space → period, auto-capitalize, differentiated haptics
- iOS: in private beta testing, not publicly available. Building SSH terminal + keyboard extension. App Store TBD.

**Writing constraints** baked into every prompt: developer-to-developer voice, no rhetorical questions, no hashtag spam, no exclamation marks, no hype words, max 1 hashtag, max 2 emoji. See `BANNED_WORDS` and `BANNED_OPENERS` in `content.py` — validation runs after generation and will reject non-compliant posts.

---

## Content calendar topics

Defined in `worker/calendar_gen.py:TOPICS`. The scheduler cycles through these in rotation, so any new features worth posting about should be added here. Current pillars:

- **awareness** — pain points the product solves
- **demo** — specific feature demonstrations
- **engagement** — replies, tips, community
- **social_proof** — milestones, user feedback, GitHub activity
- **behind_scenes** — dev updates, philosophy, iOS progress

When a major feature ships: add a `demo` topic and an `awareness` topic. When iOS goes public: update the product description in `content.py` and add a `social_proof` topic for the launch.

---

## Management CLI

```bash
cd worker && python -m worker.manage <command>
```

| Command | What it does |
|---------|-------------|
| `smoke-test` | End-to-end test of Telegram approval flow |
| `status` | DB stats (findings, queue, actions taken today) |
| `generate-calendar` | Generate next week's content schedule |
| `weekly-report` | Metrics report to Telegram |
| `curation-scan` | One-shot curation pipeline scan + AI evaluation |
| `curation-status` | Curation pipeline stats and pending approved items |
| `discovery-scan` | On-platform engagement opportunity scan |
| `scan-feeds` | Social-scroller feed scan (requires virtual desktop + CDP) |
| `scan-feeds --strategy` | Platform-specific keyword searches via social-scroller |
| `scan-feeds -p reddit -q "SSH from phone" -s commandline` | Targeted search |

---

## Key files

| File | Purpose |
|------|---------|
| `worker/main.py` | Entry point, scheduler |
| `worker/runner.py` | Orchestrates all clients and scan cycles |
| `worker/monitor.py` | Keyword search + findings queue |
| `worker/content.py` | **Product description + Gemini prompt builder** |
| `worker/calendar_gen.py` | **Content topic pool + weekly schedule generator** |
| `worker/executor.py` | Action picker, escalation tiers |
| `worker/approvals.py` | Telegram approval flow |
| `worker/discovery.py` | Curated account list + engagement classification |
| `worker/curation/` | RSS/YouTube/Twitch pipeline |
| `worker/config.py` | All config dataclasses — `SocialScrollerConfig.ssh_host` must be `""` |
| `~/social-scroller.py` | Browser automation script (runs locally on officejawn) |

---

## Credentials

```bash
pass show claude/social/twitter-keyjawn    # username, email, password (3 lines)
pass show claude/services/bluesky-keyjawn  # handle, app_password (2 lines)
pass show claude/tokens/telegram-bot       # bot token
pass show claude/tokens/producthunt-dev    # optional
pass show claude/api/youtube               # optional, for curation
pass show claude/api/twitch                # optional, for curation
```
